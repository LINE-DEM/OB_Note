---
creation_date: 2026-02-04 13:48
type: #Type/Concept
status: #Status/Complete
tags: [GCC, 编译, 工具链, 命令行, 入门, MinGW]
aliases: [GCC入门, GCC基础, GNU编译器, gcc命令]
tech_stack: #Tech/CPP #Tech/System
complexity: ⭐⭐
related_modules: [编译与解释代码, 多文件编译与链接, Make入门]
---



## 核心摘要

GCC 是 GNU 开放源代码编译器套件，通过 `gcc` 命令将 C/C++ 源代码经**预处理→编译→汇编→链接**四个阶段转化为可执行文件，是学习编译底层原理的最佳工具。

---

## 详细分析

### 1. GCC 是什么

GCC = **G**NU **C**ompiler **C**ollection（GNU 编译器集合）。它不是一个单一程序，而是一个**工具链**，包含预处理器、编译器、汇编器、链接器等一系列工具。

输入 `gcc` 命令实际上是在**调度整个工具链**协同工作。

| 编译器     | 所属平台                    | 特点                      |
| ------- | ----------------------- | ----------------------- |
| **GCC** | Linux / Windows（MinGW）  | 开源，流程透明，学习首选            |
| Clang   | macOS / Linux / Windows | API 兼容 GCC，错误信息更清晰      |
| MSVC    | Windows                 | 闭源，与 Visual Studio 深度绑定 |

> 本文全程以 GCC 为例。理解了 GCC 的流程，MSVC 只是换了工具，本质相同。参考 [[Visual Studio 编译流程]]。

---


### 2.案例

```bash
# 编译单个文件（-c 只编译不链接）
gcc ./compiler.c -I./ -g -c -o ./build/compiler.o
│   │            │    │  │  │   │
│   │            │    │  │  │   └── 输出到 build/compiler.o
│   │            │    │  │  └── 指定输出
│   │            │    │  └── 只编译，生成 .o
│   │            │    └── 包含调试信息
│   │            └── 在当前目录找头文件
│   └── 源文件
└── 编译器

# 链接所有文件（无 -c，执行链接）
gcc main.c ./build/compiler.o ./build/cprocess.o ... -I./ -g -o ./main
│   │      │                                         │    │  │   │
│   │      │                                         │    │  │   └── 最终可执行文件
│   │      │                                         │    │  └── 输出
│   │      │                                         │    └── 调试信息
│   │      │                                         └── 头文件路径
│   │      └── 已编译好的目标文件（直接链接）
│   └── 主源文件（需要编译+链接）
└── 编译器
```

### 3. 编译流程四阶段（核心）

这是 GCC 最重要的知识点。一个 `.c` 文件变成可执行文件，要经过**四个阶段**，每个阶段可以单独停下来观察中间产物：

```
┌─────────────┐
│  源代码      │  main.c
└─────┬───────┘
      │ ① 预处理    gcc -E
      ▼
┌─────────────┐
│  预处理文件   │  main.i    ← 展开 #include、#define，删除注释
└─────┬───────┘
      │ ② 编译     gcc -S
      ▼
┌─────────────┐
│  汇编文件    │  main.s    ← C 语法 → 汇编语法（人类可读的低级代码）
└─────┬───────┘
      │ ③ 汇编     gcc -c
      ▼
┌─────────────┐
│  目标文件    │  main.o    ← 二进制机器码，但不能独立运行
└─────┬───────┘
      │ ④ 链接     gcc（默认完成链接）
      ▼
┌─────────────┐
│  可执行文件   │  main.exe  ← 合并 .o + 标准库 → 可直接运行
└─────────────┘
```

#### 阶段① 预处理（Preprocessing）

**指令：** `gcc -E main.c -o main.i`

**做什么：**
- 展开 `#include <stdio.h>` → 把 `stdio.h` 的全部内容粘贴到这里
- 展开所有 `#define` 宏（文本替换）
- 处理 `#ifdef` / `#ifndef` 条件编译
- 删除所有 `//` 和 `/* */` 注释

**核心概念：** 预处理器只做**文本替换**，它不理解 C 语法。

#### 阶段② 编译（Compilation）

**指令：** `gcc -S main.c -o main.s`

**做什么：**
- 把 C 代码翻译为**汇Assembly 语言**
- **语法检查**发生在这一阶段（语法错误会在这里报出）
- **优化**也在此完成（`-O0 / -O1 / -O2 / -O3` 控制优化级别）

输出的 `.s` 文件是人类可以读的汇编代码，非常适合观察编译器做了什么。

#### 阶段③ 汇编（Assembly）

**指令：** `gcc -c main.c -o main.o`

> 注意：`gcc -c` 实际上把阶段①②③合并执行，直接从 `.c` 到 `.o`。这是**日常使用最常见的用法**。

**做什么：**
- 汇编语言 → 二进制机器码
- 生成 **`.o` 文件**（目标文件 / Object File）
- `.o` 文件包含机器码，但**不能独立运行**（还没有入口地址，还没链接标准库）

#### 阶段④ 链接（Linking）

**指令：** `gcc main.o -o main.exe`

**做什么：**
- 把多个 `.o` 文件合并在一起
- 加入**标准库**（比如 `printf` 的实现在 `libc` 里，需要链接）
- 解析**符号引用**：`A.o` 调用了 `B.o` 里的函数，链接器把地址对上
- 分配最终的内存地址
- 生成可执行文件

---

### 4. 常用标志速手册

#### 输出控制

| 标志       | 说明                                      |
| -------- | --------------------------------------- |
| `-o 文件名` | 指定输出文件名（不写则默认 `a.out`)或 a.exe (Windows) |
| `-E`     | 只执行预处理，输出 `.i`                          |
| `-S`     | 预处理+编译，输出 `.s`（汇编文件）                    |
| `-c`     | 预处理+编译+汇编，输出 `.o`（目标文件）                 |
| 不加以上标志   | 执行完整流程（到可执行文件）                          |

#### 路径控制

| 标志     | 说明                         |
| ------ | -------------------------- |
| `-I路径` | 添加头文件搜索路径（如 `-I./include`) |
| `-L路径` | 添加库文件搜索路径（如 `-L./lib`)     |
| `-l库名` | 链接指定库（如 `-lm` 链接 math 库）   |

> `-I` 和 `-L` 后面可以直接接路径（不加空格），也可以加一个空格再写路径，两种写法都行。

#### 优化与调试

| 标志    | 说明                     |
| ----- | ---------------------- |
| `-O0` | 无优化（默认，调试使用）           |
| `-O1` | 基本优化                   |
| `-O2` | 较强优化（发布版本常用）           |
| `-O3` | 最强优化                   |
| `-g`  | 生成调试信息（配合 GDB 使用，方便调试） |

#### 警告与严格检查

| 标志        | 说明                      |
| --------- | ----------------------- |
| `-Wall`   | 开启所有常见警告（**养成习惯，每次都加**） |
| `-Wextra` | 开启额外警告（比 Wall 更严格）      |
| `-Werror` | 把所有警告当成**错误**（严格模式）     |

#### 其他常用

| 标志           | 说明                      |
| ------------ | ----------------------- |
| `-std=c11`   | 指定 C 标准版本               |
| `-std=c++17` | 指定 C++ 标准版本             |
| `-v`         | 详细输出编译过程（看到底层调用了哪些工具）   |
| `-###`       | Dry run，只打印会执行的命令，不实际执行 |

---


